function setPagination(e,t){var a=$("#pagingWPQ2prev").html(),n=$("#pagingWPQ2next").html(),o="true"==checkGrid()?"-ShowInGrid%3DTrue":"",i="true"==checkGrid()?"#InplviewHash"+t+"="+o.replace("-",""):"#";$(".ms-paging").append("<select id='pageNum' style='margin-left: 5px;padding: 2px;padding-bottom: 3px;position: relative;top: 1px;'></select>"),void 0!=n&&void 0!=a?($("#pagingWPQ2next").append('<a href="#" id="goToLast">Last Page</a>'),$("#pagingWPQ2prev").prepend('<a href="'+i+'" id="goToFirst" style="margin-right: 2px;">First Page</a>'),$("#goToLast").attr("href",_spPageContextInfo.serverRequestPath+e),addCss()):void 0!=a?($("#pagingWPQ2prev").prepend('<a href="'+i+'" id="goToFirst">First Page</a>'),addCss()):void 0!=n&&($("#pagingWPQ2next").append('<a href="#" id="goToLast">Last Page</a>'),$("#goToLast").attr("href",_spPageContextInfo.serverRequestPath+e),addCss())}function getData(e,t){return $.ajax({url:e+""+t,type:"GET",datatype:"JSON",async:"false",headers:{accept:"application/json;odata=verbose"}})}function errorMsg(e,t){console.log(e+"<br />"+t),alert("Something went wrong. Please refresh your browser")}function addCss(){$("#goToFirst, #goToLast").css({border:"1px solid #ababab",padding:"6px","margin-left":"2px","font-size":"9px",position:"relative",top:"-4px",color:"#484848"})}function drpDwnPg(e,t,a,n,o,r,s,p){var g,d,c,l,u,f,h="true"==checkGrid()?"-ShowInGrid%3DTrue":"",P="true"==checkGrid()?"#InplviewHash"+t+"="+h.replace("-",""):"#";s.success(function(a){for(l=a.d.results,$("#pageNum").append("<option value='"+P+"'>1</option>"),u=$(".ms-paging").text(),u=u.substring(u.lastIndexOf("- ")+1,u.lastIndexOf("1")),u=parseInt(u)/o,u=u.toString().indexOf(".")>-1?Math.floor(u)+1:u,i=0;i<Math.floor(e);i++)g=(i+1)*parseInt(o),d=(i+1)*parseInt(o)+1,c=l[g-1].ID,f=i+2==u?"selected":"",$("#pageNum").append("<option value='#InplviewHash"+t+"=Paged%3DTRUE-p_ID%3D"+c+h+"-PageFirstRow%3D"+d+"' "+f+">"+(i+2)+"</option>")})}function checkGrid(){var e,t;return e=window.location.href,t=e.indexOf("ShowInGrid")>-1?"true":"false"}function mainProc(){var e,t,a,n,o,i,r,s,p,g,d,c,l,u,f=_spPageContextInfo.pageListId.replace(/{/g,"").replace(/}/g,""),h=_spPageContextInfo.webServerRelativeUrl+"/_api/web/lists(guid'"+f+"')/items",P=getData(h,"?$top=99999999&$orderby=Id%20asc");a=$(".ms-vh-div").attr("sortfields"),a=a.substring(a.lastIndexOf("{")+1,a.lastIndexOf("}")),d=$(".ms-pivotControl-surfacedOpt-selected").text(),c=_spPageContextInfo.webServerRelativeUrl+"/_api/web/lists(guid'"+f+"')/Views?$filter=Title eq '"+d+"'",l=getData(c,""),l.success(function(d){g=d.d.results,g=g[0].RowLimit,t=g,P.success(function(g){e=g.d.results,o=e.length,n=Math.floor(parseInt(o)/t)*t+1,p=parseInt(o)/t,i=Math.abs(Math.floor(parseInt(o)/t)*t-o)+1,r=getData(h,"?$top="+i+"&$orderby=Id%20desc"),r.success(function(o){u="true"==checkGrid()?"-ShowInGrid%3DTrue":"",e=o.d.results,i=e[parseInt(e.length)-1].ID,s=p.toString().indexOf(".")>-1?"#InplviewHash"+a+"=Paged%3DTRUE-p_ID%3D"+i+u+"-PageFirstRow%3D"+n:"#InplviewHash"+a+"=Paged%3DTRUE-p_ID%3D"+Math.abs(parseInt(i)-t)+u+"-PageFirstRow%3D"+Math.abs(parseInt(n)-t),setPagination(s,a),drpDwnPg(p,a,i,n,t,h,P,s)}).error(function(e,t){errorMsg(e,t)})}).error(function(e,t){errorMsg(e,t)})}).error(function(e,t){errorMsg(e,t)})}$(document).ready(function(){setTimeout(function(){mainProc()},500),$(document).on("click",".ms-heroCommandLink:contains('edit'), a[title='Edit this list using Quick Edit mode.']",function(){mainProc()}),$("body").on("click","#goToFirst,#goToLast",function(){mainProc()}),$("body").on("click","#pagingWPQ2prev img,#pagingWPQ2next img",function(){mainProc()}),$("body").on("change","#pageNum",function(){window.location="#"==$(this).val()?"#":_spPageContextInfo.serverRequestPath+$(this).val(),$("#goToLast, #goToFirst, #pageNum").remove(),mainProc()}),$("body").on("click",".ms-heroCommandLink",function(){mainProc()})});
